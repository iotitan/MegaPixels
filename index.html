<!DOCTYPE html>
<html>
    <head>
        <title>Pixels</title>
        <style>
            body {
                font-family: arial;
            }
        </style>
    </head>

    <body>
        <h2>Pixels!</h2>
        <ol>
            <li>Select settings.</li>
            <li>Press generate.</li>
            <li>Profit!</li>
        </ol>

        <table>
            <tr>
                <td><strong>Color list (comma separated): </strong></td>
                <td><input id="colorList" type="text" value="#FF0000, #0000FF" /></td>
            </tr>
            <tr>
                <td><strong>Height: </strong></td>
                <td><input id="pixelRows" type="text" value="10" /></td>
            </tr>
            <tr>
                <td><strong>Width: </strong></td>
                <td><input id="pixelCols" type="text" value="10" /></td>
            </tr>
            <tr>
                <td><strong>Pixel size: </strong></td>
                <td><input id="pixelSize" type="text" value="50" /></td>
            </tr>
        </table>
        <button id="generateImage">Generate Image</button>

        <br>

        <canvas id="outCanvas"></canvas>

        <script src="./ImageUtils.js"></script>
        <script>
            var mOutCanvas = document.getElementById("outCanvas");
            var mOutCtx = mOutCanvas.getContext("2d");

            var COLOR_LIST_ID = "colorList";
            var PIXEL_ROWS_ID = "pixelRows";
            var PIXEL_COLS_ID = "pixelCols";
            var PIXEL_SIZE_ID = "pixelSize";

            function onGeneratePressed(e) {
                var rows = parseInt(document.getElementById(PIXEL_ROWS_ID).value, 10);
                var cols = parseInt(document.getElementById(PIXEL_COLS_ID).value, 10);
                var pixelSize = parseInt(document.getElementById(PIXEL_SIZE_ID).value, 10);
                var colors = document.getElementById(COLOR_LIST_ID).value.split(",");

                var colorList = new Array();
                for (var i = 0; i < colors.length; i++) {
                    colorList[i] = createColorFromHex(colors[i].trim());
                }

                // Resize the output canvas.
                mOutCanvas.width = pixelSize * cols;
                mOutCanvas.height = pixelSize * rows;

                var imageData = generateImageData(rows, cols, pixelSize, colorList);

                renderImage(imageData, pixelSize);
            }

            function renderImage(imageData, pixelSize) {
                for (var col = 0; col < imageData.length; col++) {
                    for (var row = 0; row < imageData[col].length; row++) {
                        mOutCtx.fillStyle = colorToHex(imageData[col][row]);
                        mOutCtx.fillRect(col * pixelSize, row * pixelSize, pixelSize, pixelSize);
                    }
                }
            }

            function colorToHex(color) {
                var r = color.R.toString(16);
                var g = color.G.toString(16);
                var b = color.B.toString(16);
                return "#" + (r.length < 2 ? "0" : "") + "" + r +
                        "" + (g.length < 2 ? "0" : "") + "" + g +
                        "" + (b.length < 2 ? "0" : "") + "" + b;
            }

            function generateImageData(rows, cols, pixelSize, colorList) {
                if (colorList.length < 2) {
                    alert("More than two colors are required!");
                    throw "More than two colors are required!";
                }

                var rowsPerColor = Math.floor(rows / (colorList.length - 1));

                // Create pixel array to work on.
                var pixelArray = new Array(rows);
                for (var i = 0; i < rows; i++) {
                    var colorShiftAmount = (i % rowsPerColor) / rowsPerColor;
                    var color1 = colorList[Math.floor(i / rowsPerColor)];
                    var color2 = colorList[Math.floor(i / rowsPerColor) + 1];
                    pixelArray[i] = new Array(cols);
                    for (var j = 0; j < cols; j++) {
                        pixelArray[i][j] = createColor(
                                color2.R * colorShiftAmount + color1.R * (1 - colorShiftAmount),
                                color2.G * colorShiftAmount + color1.G * (1 - colorShiftAmount),
                                color2.B * colorShiftAmount + color1.B * (1 - colorShiftAmount));
                    }
                }
                return pixelArray;
            }

            function createColorFromHex(hexString) {
                if (hexString.charAt(0) != "#" && hexString.length != 7) {
                    alert("Invalid color: " + colorList[i]);
                    throw "Invalid color: " + colorList[i];
                }
                var r = parseInt(hexString.substring(1, 3), 16);
                var g = parseInt(hexString.substring(3, 5), 16);
                var b = parseInt(hexString.substring(5), 16);
                return {"R":r, "G":g, "B":b};
            }

            function createColor(r, g, b) {
                return {"R":Math.floor(r), "G":Math.floor(g), "B":Math.floor(b)};
            }

            document.getElementById("generateImage").addEventListener("click", onGeneratePressed);

        </script>
    </body>
</html>
